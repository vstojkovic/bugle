use std::collections::HashMap;

use fltk::app;
use fltk::enums::Color;
use lazy_static::lazy_static;

use crate::config::ThemeChoice;

pub struct Theme {
    colors: HashMap<u8, (u8, u8, u8)>,
}

impl Theme {
    pub fn new() -> Self {
        Self {
            colors: HashMap::new(),
        }
    }

    pub fn from_config(theme: ThemeChoice) -> &'static Self {
        match theme {
            ThemeChoice::Light => &LIGHT_THEME,
            ThemeChoice::Dark => &DARK_THEME,
        }
    }

    pub fn set_color(&mut self, index: u8, r: u8, g: u8, b: u8) {
        self.colors.insert(index, (r, g, b));
    }

    pub fn apply(&self) {
        for (&idx, &(r, g, b)) in self.colors.iter() {
            app::set_color(Color::by_index(idx), r, g, b);
        }
        app::redraw();
    }
}

lazy_static! {
    static ref LIGHT_THEME: Theme = {
        let mut theme = Theme::new();
        theme.set_color(0, 0x00, 0x00, 0x00);
        theme.set_color(1, 0xFF, 0x00, 0x00);
        theme.set_color(2, 0x00, 0xFF, 0x00);
        theme.set_color(3, 0xFF, 0xFF, 0x00);
        theme.set_color(4, 0x00, 0x00, 0xFF);
        theme.set_color(5, 0xFF, 0x00, 0xFF);
        theme.set_color(6, 0x00, 0xFF, 0xFF);
        theme.set_color(7, 0xFF, 0xFF, 0xFF);
        theme.set_color(8, 0x55, 0x55, 0x55);
        theme.set_color(9, 0xC6, 0x71, 0x71);
        theme.set_color(10, 0x71, 0xC6, 0x71);
        theme.set_color(11, 0x8E, 0x8E, 0x38);
        theme.set_color(12, 0x71, 0x71, 0xC6);
        theme.set_color(13, 0x8E, 0x38, 0x8E);
        theme.set_color(14, 0x38, 0x8E, 0x8E);
        theme.set_color(15, 0x00, 0x00, 0x80);
        theme.set_color(16, 0x98, 0x98, 0xA8);
        theme.set_color(32, 0x00, 0x00, 0x00);
        theme.set_color(33, 0x0D, 0x0D, 0x0D);
        theme.set_color(34, 0x1A, 0x1A, 0x1A);
        theme.set_color(35, 0x26, 0x26, 0x26);
        theme.set_color(36, 0x31, 0x31, 0x31);
        theme.set_color(37, 0x3D, 0x3D, 0x3D);
        theme.set_color(38, 0x48, 0x48, 0x48);
        theme.set_color(39, 0x55, 0x55, 0x55);
        theme.set_color(40, 0x5F, 0x5F, 0x5F);
        theme.set_color(41, 0x6A, 0x6A, 0x6A);
        theme.set_color(42, 0x75, 0x75, 0x75);
        theme.set_color(43, 0x80, 0x80, 0x80);
        theme.set_color(44, 0x8A, 0x8A, 0x8A);
        theme.set_color(45, 0x95, 0x95, 0x95);
        theme.set_color(46, 0xA0, 0xA0, 0xA0);
        theme.set_color(47, 0xAA, 0xAA, 0xAA);
        theme.set_color(48, 0xB5, 0xB5, 0xB5);
        theme.set_color(49, 0xC0, 0xC0, 0xC0);
        theme.set_color(50, 0xCB, 0xCB, 0xCB);
        theme.set_color(51, 0xD5, 0xD5, 0xD5);
        theme.set_color(52, 0xE0, 0xE0, 0xE0);
        theme.set_color(53, 0xEA, 0xEA, 0xEA);
        theme.set_color(54, 0xF5, 0xF5, 0xF5);
        theme.set_color(55, 0xFF, 0xFF, 0xFF);
        theme.set_color(56, 0x00, 0x00, 0x00);
        theme.set_color(57, 0x00, 0x24, 0x00);
        theme.set_color(58, 0x00, 0x49, 0x00);
        theme.set_color(59, 0x00, 0x6D, 0x00);
        theme.set_color(60, 0x00, 0x92, 0x00);
        theme.set_color(61, 0x00, 0xB6, 0x00);
        theme.set_color(62, 0x00, 0xDB, 0x00);
        theme.set_color(63, 0x00, 0xFF, 0x00);
        theme.set_color(64, 0x40, 0x00, 0x00);
        theme.set_color(65, 0x40, 0x24, 0x00);
        theme.set_color(66, 0x40, 0x49, 0x00);
        theme.set_color(67, 0x40, 0x6D, 0x00);
        theme.set_color(68, 0x40, 0x92, 0x00);
        theme.set_color(69, 0x40, 0xB6, 0x00);
        theme.set_color(70, 0x40, 0xDB, 0x00);
        theme.set_color(71, 0x40, 0xFF, 0x00);
        theme.set_color(72, 0x80, 0x00, 0x00);
        theme.set_color(73, 0x80, 0x24, 0x00);
        theme.set_color(74, 0x80, 0x49, 0x00);
        theme.set_color(75, 0x80, 0x6D, 0x00);
        theme.set_color(76, 0x80, 0x92, 0x00);
        theme.set_color(77, 0x80, 0xB6, 0x00);
        theme.set_color(78, 0x80, 0xDB, 0x00);
        theme.set_color(79, 0x80, 0xFF, 0x00);
        theme.set_color(80, 0xBF, 0x00, 0x00);
        theme.set_color(81, 0xBF, 0x24, 0x00);
        theme.set_color(82, 0xBF, 0x49, 0x00);
        theme.set_color(83, 0xBF, 0x6D, 0x00);
        theme.set_color(84, 0xBF, 0x92, 0x00);
        theme.set_color(85, 0xBF, 0xB6, 0x00);
        theme.set_color(86, 0xBF, 0xDB, 0x00);
        theme.set_color(87, 0xBF, 0xFF, 0x00);
        theme.set_color(88, 0xFF, 0x00, 0x00);
        theme.set_color(89, 0xFF, 0x24, 0x00);
        theme.set_color(90, 0xFF, 0x49, 0x00);
        theme.set_color(91, 0xFF, 0x6D, 0x00);
        theme.set_color(92, 0xFF, 0x92, 0x00);
        theme.set_color(93, 0xFF, 0xB6, 0x00);
        theme.set_color(94, 0xFF, 0xDB, 0x00);
        theme.set_color(95, 0xFF, 0xFF, 0x00);
        theme.set_color(96, 0x00, 0x00, 0x40);
        theme.set_color(97, 0x00, 0x24, 0x40);
        theme.set_color(98, 0x00, 0x49, 0x40);
        theme.set_color(99, 0x00, 0x6D, 0x40);
        theme.set_color(100, 0x00, 0x92, 0x40);
        theme.set_color(101, 0x00, 0xB6, 0x40);
        theme.set_color(102, 0x00, 0xDB, 0x40);
        theme.set_color(103, 0x00, 0xFF, 0x40);
        theme.set_color(104, 0x40, 0x00, 0x40);
        theme.set_color(105, 0x40, 0x24, 0x40);
        theme.set_color(106, 0x40, 0x49, 0x40);
        theme.set_color(107, 0x40, 0x6D, 0x40);
        theme.set_color(108, 0x40, 0x92, 0x40);
        theme.set_color(109, 0x40, 0xB6, 0x40);
        theme.set_color(110, 0x40, 0xDB, 0x40);
        theme.set_color(111, 0x40, 0xFF, 0x40);
        theme.set_color(112, 0x80, 0x00, 0x40);
        theme.set_color(113, 0x80, 0x24, 0x40);
        theme.set_color(114, 0x80, 0x49, 0x40);
        theme.set_color(115, 0x80, 0x6D, 0x40);
        theme.set_color(116, 0x80, 0x92, 0x40);
        theme.set_color(117, 0x80, 0xB6, 0x40);
        theme.set_color(118, 0x80, 0xDB, 0x40);
        theme.set_color(119, 0x80, 0xFF, 0x40);
        theme.set_color(120, 0xBF, 0x00, 0x40);
        theme.set_color(121, 0xBF, 0x24, 0x40);
        theme.set_color(122, 0xBF, 0x49, 0x40);
        theme.set_color(123, 0xBF, 0x6D, 0x40);
        theme.set_color(124, 0xBF, 0x92, 0x40);
        theme.set_color(125, 0xBF, 0xB6, 0x40);
        theme.set_color(126, 0xBF, 0xDB, 0x40);
        theme.set_color(127, 0xBF, 0xFF, 0x40);
        theme.set_color(128, 0xFF, 0x00, 0x40);
        theme.set_color(129, 0xFF, 0x24, 0x40);
        theme.set_color(130, 0xFF, 0x49, 0x40);
        theme.set_color(131, 0xFF, 0x6D, 0x40);
        theme.set_color(132, 0xFF, 0x92, 0x40);
        theme.set_color(133, 0xFF, 0xB6, 0x40);
        theme.set_color(134, 0xFF, 0xDB, 0x40);
        theme.set_color(135, 0xFF, 0xFF, 0x40);
        theme.set_color(136, 0x00, 0x00, 0x80);
        theme.set_color(137, 0x00, 0x24, 0x80);
        theme.set_color(138, 0x00, 0x49, 0x80);
        theme.set_color(139, 0x00, 0x6D, 0x80);
        theme.set_color(140, 0x00, 0x92, 0x80);
        theme.set_color(141, 0x00, 0xB6, 0x80);
        theme.set_color(142, 0x00, 0xDB, 0x80);
        theme.set_color(143, 0x00, 0xFF, 0x80);
        theme.set_color(144, 0x40, 0x00, 0x80);
        theme.set_color(145, 0x40, 0x24, 0x80);
        theme.set_color(146, 0x40, 0x49, 0x80);
        theme.set_color(147, 0x40, 0x6D, 0x80);
        theme.set_color(148, 0x40, 0x92, 0x80);
        theme.set_color(149, 0x40, 0xB6, 0x80);
        theme.set_color(150, 0x40, 0xDB, 0x80);
        theme.set_color(151, 0x40, 0xFF, 0x80);
        theme.set_color(152, 0x80, 0x00, 0x80);
        theme.set_color(153, 0x80, 0x24, 0x80);
        theme.set_color(154, 0x80, 0x49, 0x80);
        theme.set_color(155, 0x80, 0x6D, 0x80);
        theme.set_color(156, 0x80, 0x92, 0x80);
        theme.set_color(157, 0x80, 0xB6, 0x80);
        theme.set_color(158, 0x80, 0xDB, 0x80);
        theme.set_color(159, 0x80, 0xFF, 0x80);
        theme.set_color(160, 0xBF, 0x00, 0x80);
        theme.set_color(161, 0xBF, 0x24, 0x80);
        theme.set_color(162, 0xBF, 0x49, 0x80);
        theme.set_color(163, 0xBF, 0x6D, 0x80);
        theme.set_color(164, 0xBF, 0x92, 0x80);
        theme.set_color(165, 0xBF, 0xB6, 0x80);
        theme.set_color(166, 0xBF, 0xDB, 0x80);
        theme.set_color(167, 0xBF, 0xFF, 0x80);
        theme.set_color(168, 0xFF, 0x00, 0x80);
        theme.set_color(169, 0xFF, 0x24, 0x80);
        theme.set_color(170, 0xFF, 0x49, 0x80);
        theme.set_color(171, 0xFF, 0x6D, 0x80);
        theme.set_color(172, 0xFF, 0x92, 0x80);
        theme.set_color(173, 0xFF, 0xB6, 0x80);
        theme.set_color(174, 0xFF, 0xDB, 0x80);
        theme.set_color(175, 0xFF, 0xFF, 0x80);
        theme.set_color(176, 0x00, 0x00, 0xBF);
        theme.set_color(177, 0x00, 0x24, 0xBF);
        theme.set_color(178, 0x00, 0x49, 0xBF);
        theme.set_color(179, 0x00, 0x6D, 0xBF);
        theme.set_color(180, 0x00, 0x92, 0xBF);
        theme.set_color(181, 0x00, 0xB6, 0xBF);
        theme.set_color(182, 0x00, 0xDB, 0xBF);
        theme.set_color(183, 0x00, 0xFF, 0xBF);
        theme.set_color(184, 0x40, 0x00, 0xBF);
        theme.set_color(185, 0x40, 0x24, 0xBF);
        theme.set_color(186, 0x40, 0x49, 0xBF);
        theme.set_color(187, 0x40, 0x6D, 0xBF);
        theme.set_color(188, 0x40, 0x92, 0xBF);
        theme.set_color(189, 0x40, 0xB6, 0xBF);
        theme.set_color(190, 0x40, 0xDB, 0xBF);
        theme.set_color(191, 0x40, 0xFF, 0xBF);
        theme.set_color(192, 0x80, 0x00, 0xBF);
        theme.set_color(193, 0x80, 0x24, 0xBF);
        theme.set_color(194, 0x80, 0x49, 0xBF);
        theme.set_color(195, 0x80, 0x6D, 0xBF);
        theme.set_color(196, 0x80, 0x92, 0xBF);
        theme.set_color(197, 0x80, 0xB6, 0xBF);
        theme.set_color(198, 0x80, 0xDB, 0xBF);
        theme.set_color(199, 0x80, 0xFF, 0xBF);
        theme.set_color(200, 0xBF, 0x00, 0xBF);
        theme.set_color(201, 0xBF, 0x24, 0xBF);
        theme.set_color(202, 0xBF, 0x49, 0xBF);
        theme.set_color(203, 0xBF, 0x6D, 0xBF);
        theme.set_color(204, 0xBF, 0x92, 0xBF);
        theme.set_color(205, 0xBF, 0xB6, 0xBF);
        theme.set_color(206, 0xBF, 0xDB, 0xBF);
        theme.set_color(207, 0xBF, 0xFF, 0xBF);
        theme.set_color(208, 0xFF, 0x00, 0xBF);
        theme.set_color(209, 0xFF, 0x24, 0xBF);
        theme.set_color(210, 0xFF, 0x49, 0xBF);
        theme.set_color(211, 0xFF, 0x6D, 0xBF);
        theme.set_color(212, 0xFF, 0x92, 0xBF);
        theme.set_color(213, 0xFF, 0xB6, 0xBF);
        theme.set_color(214, 0xFF, 0xDB, 0xBF);
        theme.set_color(215, 0xFF, 0xFF, 0xBF);
        theme.set_color(216, 0x00, 0x00, 0xFF);
        theme.set_color(217, 0x00, 0x24, 0xFF);
        theme.set_color(218, 0x00, 0x49, 0xFF);
        theme.set_color(219, 0x00, 0x6D, 0xFF);
        theme.set_color(220, 0x00, 0x92, 0xFF);
        theme.set_color(221, 0x00, 0xB6, 0xFF);
        theme.set_color(222, 0x00, 0xDB, 0xFF);
        theme.set_color(223, 0x00, 0xFF, 0xFF);
        theme.set_color(224, 0x40, 0x00, 0xFF);
        theme.set_color(225, 0x40, 0x24, 0xFF);
        theme.set_color(226, 0x40, 0x49, 0xFF);
        theme.set_color(227, 0x40, 0x6D, 0xFF);
        theme.set_color(228, 0x40, 0x92, 0xFF);
        theme.set_color(229, 0x40, 0xB6, 0xFF);
        theme.set_color(230, 0x40, 0xDB, 0xFF);
        theme.set_color(231, 0x40, 0xFF, 0xFF);
        theme.set_color(232, 0x80, 0x00, 0xFF);
        theme.set_color(233, 0x80, 0x24, 0xFF);
        theme.set_color(234, 0x80, 0x49, 0xFF);
        theme.set_color(235, 0x80, 0x6D, 0xFF);
        theme.set_color(236, 0x80, 0x92, 0xFF);
        theme.set_color(237, 0x80, 0xB6, 0xFF);
        theme.set_color(238, 0x80, 0xDB, 0xFF);
        theme.set_color(239, 0x80, 0xFF, 0xFF);
        theme.set_color(240, 0xBF, 0x00, 0xFF);
        theme.set_color(241, 0xBF, 0x24, 0xFF);
        theme.set_color(242, 0xBF, 0x49, 0xFF);
        theme.set_color(243, 0xBF, 0x6D, 0xFF);
        theme.set_color(244, 0xBF, 0x92, 0xFF);
        theme.set_color(245, 0xBF, 0xB6, 0xFF);
        theme.set_color(246, 0xBF, 0xDB, 0xFF);
        theme.set_color(247, 0xBF, 0xFF, 0xFF);
        theme.set_color(248, 0xFF, 0x00, 0xFF);
        theme.set_color(249, 0xFF, 0x24, 0xFF);
        theme.set_color(250, 0xFF, 0x49, 0xFF);
        theme.set_color(251, 0xFF, 0x6D, 0xFF);
        theme.set_color(252, 0xFF, 0x92, 0xFF);
        theme.set_color(253, 0xFF, 0xB6, 0xFF);
        theme.set_color(254, 0xFF, 0xDB, 0xFF);
        theme.set_color(255, 0xFF, 0xFF, 0xFF);
        theme.set_color(254, 0xDC, 0xF0, 0xF0);

        theme
    };
    pub static ref DARK_THEME: Theme = {
        let mut theme = Theme::new();

        theme.set_color(0, 0xFF, 0xFF, 0xFF);
        theme.set_color(1, 0x96, 0x1E, 0x1E);
        theme.set_color(2, 0x00, 0xB4, 0x00);
        theme.set_color(3, 0xB4, 0xB4, 0x00);
        theme.set_color(4, 0x00, 0x00, 0xB4);
        theme.set_color(5, 0xB4, 0x00, 0xB4);
        theme.set_color(6, 0x00, 0xB4, 0xB4);
        theme.set_color(7, 0x3A, 0x3A, 0x3A);
        theme.set_color(8, 0x26, 0x26, 0x26);
        theme.set_color(9, 0x96, 0x5A, 0x5A);
        theme.set_color(10, 0x5A, 0x96, 0x5A);
        theme.set_color(11, 0x96, 0x96, 0x5A);
        theme.set_color(12, 0x5A, 0x5A, 0x96);
        theme.set_color(13, 0x96, 0x5A, 0x96);
        theme.set_color(14, 0x5A, 0x96, 0x96);
        theme.set_color(15, 0xD6, 0xD6, 0xD6);
        theme.set_color(16, 0x18, 0x18, 0x18);
        theme.set_color(32, 0xE0, 0xE0, 0xE0);
        theme.set_color(33, 0x0A, 0x0A, 0x0A);
        theme.set_color(34, 0x10, 0x10, 0x10);
        theme.set_color(35, 0x15, 0x15, 0x15);
        theme.set_color(36, 0x1A, 0x1A, 0x1A);
        theme.set_color(37, 0x20, 0x20, 0x20);
        theme.set_color(38, 0x25, 0x25, 0x25);
        theme.set_color(39, 0x2A, 0x2A, 0x2A);
        theme.set_color(40, 0x30, 0x30, 0x30);
        theme.set_color(41, 0x35, 0x35, 0x35);
        theme.set_color(42, 0x3A, 0x3A, 0x3A);
        theme.set_color(43, 0x40, 0x40, 0x40);
        theme.set_color(44, 0x45, 0x45, 0x45);
        theme.set_color(45, 0x4A, 0x4A, 0x4A);
        theme.set_color(46, 0x50, 0x50, 0x50);
        theme.set_color(47, 0x55, 0x55, 0x55);
        theme.set_color(48, 0x5A, 0x5A, 0x5A);
        theme.set_color(49, 0x53, 0x53, 0x53);
        theme.set_color(50, 0x65, 0x65, 0x65);
        theme.set_color(51, 0x6A, 0x6A, 0x6A);
        theme.set_color(52, 0x70, 0x70, 0x70);
        theme.set_color(53, 0x75, 0x75, 0x75);
        theme.set_color(54, 0x7A, 0x7A, 0x7A);
        theme.set_color(55, 0xB4, 0xB4, 0xB4);
        theme.set_color(56, 0x00, 0x00, 0x00);
        theme.set_color(59, 0x1E, 0x8C, 0x1E);
        theme.set_color(63, 0x00, 0xB4, 0x00);
        theme.set_color(71, 0x00, 0xB4, 0x00);
        theme.set_color(88, 0xB4, 0x00, 0x00);
        theme.set_color(90, 0xC8, 0x48, 0x3C);
        theme.set_color(91, 0xB4, 0x78, 0x00);
        theme.set_color(94, 0x96, 0x64, 0x1E);
        theme.set_color(95, 0xB4, 0xB4, 0x00);
        theme.set_color(124, 0xBF, 0x91, 0x3F);
        theme.set_color(254, 0x3C, 0x42, 0x42);
        theme.set_color(255, 0x32, 0x32, 0x32);

        theme
    };
}
